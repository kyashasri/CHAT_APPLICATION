<!DOCTYPE html>
<html>
<head>
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<div class="app-container">

    <!-- =========================
         LEFT SIDEBAR
    ========================== -->
    <div class="sidebar">

    <div class="sidebar-split">

        <!-- ================= PRIVATE SECTION ================= -->
        <div class="private-section">
            <div class="sidebar-header">
                ðŸ’¬ Private Chats
            </div>

            <div style="padding:15px;">
                <form action="{{ url_for('create_chat') }}" method="POST">
                    <input type="email" name="email" placeholder="Start chat with email" required>
                    <button type="submit">Start Chat</button>
                </form>
            </div>

            <div class="chat-list">
                {% for chat in chats %}
                    <div class="chat-item">
                        <a href="{{ url_for('chat', chat_id=chat._id) }}" class="chat-item">
                            {{ chat.name }}
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>


        <!-- ================= GROUP SECTION ================= -->
        <div class="group-section">
            <div class="sidebar-header">
                ðŸ‘¥ Group Chats
            </div>

            <div style="padding:15px;">
                <form action="{{ url_for('create_group') }}" method="POST">
                    <input type="text" name="group_name" placeholder="Group Name" required>

                    <div id="memberContainer">
                        <div class="member-row">
                            <input type="email" name="members[]" placeholder="Member email" required>
                        </div>
                    </div>

                    <button type="button" onclick="addMemberField()" style="margin-top:5px;">
                        + Add Member
                    </button>

                    <button type="submit" style="margin-top:8px;">
                        Create Group
                    </button>
                </form>
            </div>

            <div class="chat-list">
                {% for group in groups %}
                    <div class="chat-item">
                        <a href="{{ url_for('group_chat', group_id=group._id) }}" class="chat-item">
                            {{ group.name }}
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>

    </div>

    <div style="padding:15px;">
        <a href="{{ url_for('logout') }}">
            <button style="width:100%; background:#ff4d4d;">Logout</button>
        </a>
    </div>

</div>

<!-- =========================
     JavaScript
========================== -->

<script>
// Add member row
function addMemberField() {
    var container = document.getElementById("memberContainer");

    var div = document.createElement("div");
    div.className = "member-row";

    div.innerHTML = `
        <input type="email" name="members[]" placeholder="Member email" required>
        <button type="button" onclick="this.parentElement.remove()">Remove</button>
    `;

    container.appendChild(div);
}

// Popup message from URL
window.onload = function() {
    const params = new URLSearchParams(window.location.search);

    if (params.get("error")) {
        alert(params.get("error"));
    }

    if (params.get("success")) {
        alert(params.get("success"));
    }
};
</script>

</body>
</html>
