<!DOCTYPE html>
<html>
<head>
    <title>Private Chat</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

<h2>Welcome {{ name }} ðŸ‘‹</h2>

<hr>

<div class="chat-box" id="chat-box">

    {% for msg in messages %}
        <div class="message {% if msg.sender == session['email'] %}sender{% else %}receiver{% endif %}">
            <div class="bubble">
                {{ msg.text }}
                <div class="time">{{ msg.timestamp }}</div>
            </div>
        </div>
    {% endfor %}

</div>

<hr>

<input type="hidden" id="chat_id" value="{{ chat_id }}">

<input type="text" id="message" placeholder="Type a message..." style="width:70%; padding:8px;">
<button onclick="sendMessage()" style="padding:8px 15px;">Send</button>

<br><br>

<a href="{{ url_for('home') }}">
    <button>Back</button>
</a>

<script>
    var socket = io();
    var username = "{{ session['email'] }}";
    var chat_id = document.getElementById("chat_id").value;

    socket.emit("join_room", { chat_id: chat_id });

    function sendMessage() {
        var messageInput = document.getElementById("message");
        var message = messageInput.value;

        if (message.trim() === "") return;

        socket.emit("send_message", {
            message: message,
            sender: username,
            chat_id: chat_id
        });

        messageInput.value = "";
    }

    socket.on("receive_message", function(data) {
        var chatBox = document.getElementById("chat-box");

        chatBox.innerHTML += `
            <div class="message ${data.sender === username ? 'sender' : 'receiver'}">
                <div class="bubble">
                    ${data.message}
                    <div class="time">${data.timestamp}</div>
                </div>
            </div>
        `;

        chatBox.scrollTop = chatBox.scrollHeight;
    });
</script>

</body>
</html>



